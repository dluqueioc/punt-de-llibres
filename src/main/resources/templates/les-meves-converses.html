<!DOCTYPE html>
<html layout:decorate="~{layout/base.html}">
    <head>
        <title>Les meves converses</title>
        <link
            rel="stylesheet"
            type="text/css"
            href="/css/les-meves-converses.css"
        />
    </head>

    <body>
        <section
            layout:fragment="content"
            id="app"
            class="les-meves-converses-page"
            v-cloak
        >
            <div class="container">
                <div class="row">
                    <div class="col s12">
                        <h1 class="header center black-pearl-text">
                            Les meves converses
                        </h1>
                    </div>
                </div>

                <div class="row">
                    <div class="col s12">
                        <p
                            class="center-align"
                            v-if="! chats.length"
                        >
                            No tens cap conversa iniciada
                        </p>
                    </div>
                </div>

                <div
                    class="row cardConversa"
                    :key="chat.id"
                    v-for="(chat, index) in chats"
                >
                    <div class="col s12">
                        <div class="card horizontal hoverable oyster-bay">
                            <div class="col s12 l4 center-align">
                                <div class="img-usuari-container" :style="{ backgroundImage : `url(../img/avatars/${otherUser(index).avatar})` }">
                                </div>
                            </div>
                            <div class="col s12 l8 card-stacked">
                                <div class="row">
                                    <div class="card-content col s12">
                                        <div class="row">
                                            <div class="column dades">
                                                <p>
                                                    <span class="negreta"
                                                        >Conversa amb:
                                                    </span>
                                                    {{ otherUser(index).username }}
                                                </p>
                                                <p>
                                                    <span class="negreta"
                                                        >Darrer missatge:
                                                    </span>
                                                    <em>{{ lastMessageBody(index) }}</em>
                                                </p>
                                                <p>
                                                    <span class="negreta">
                                                        Enviat per:
                                                    </span>
                                                    {{ lastMessageInfo(index) }}
                                                </p>
                                            </div>
                                            <div
                                                class="column button"
                                            >
                                                <a
                                                    class="waves-effect waves-light btn"
                                                    @click="goToChat(chat.id)"
                                                    >Anar a la conversa</a
                                                >
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <th:block layout:fragment="script"
            ><script th:inline="javascript">
                window.myUserId = /*[[${myUserId}]]*/ [];
                window.myChats = /*[[${myChats}]]*/ [];
            </script>
            <script th:src="@{/js/les-meves-converses.js}"></script>
        </th:block>
    </body>
</html>
