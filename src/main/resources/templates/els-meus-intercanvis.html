<!DOCTYPE html>
<html layout:decorate="~{layout/base.html}">
    <head>
        <title>Els meus intercanvis</title>
        <link
            rel="stylesheet"
            type="text/css"
            href="/css/els-meus-intercanvis.css"
        />
    </head>

    <body>
        <section
            layout:fragment="content"
            id="app"
            class="els-meus-intercanvis-page"
            v-cloak
        >
            <h1 class="header center black-pearl-text">Els meus intercanvis</h1>
            <p
                v-if="! exchanges.length"
                v-cloak
                class="center-align no-exchanges"
            >
                No has iniciat cap intercanvi. Consulta els
                <a href="/llibres-disponibles">llibres&nbsp;disponibles</a> i
                mira si te n'interessa algun!
            </p>
            <p
                v-else-if="! exchangesShown.length"
                v-cloak
                class="center-align no-exchanges"
            >
                Ja has completat tots els teus intercanvis. Consulta els
                <a href="/llibres-disponibles">llibres&nbsp;disponibles</a> per
                veure si t'interessen més llibres!
            </p>
            <p
                v-else
                v-cloak
                class="center-align no-exchanges"
            >
                Aquí podràs veure tots els teus intercanvis no cancel·lats, ordenats de més recent a més antic.
            </p>
            <div class="row right">
                <span>Mostrar intercanvis completats</span>
                <div class="switch" style="display: inline;">
                    <label>
                        <input
                            v-if="! closedExchanges.length"
                            disabled
                            type="checkbox"
                        />
                        <input v-else type="checkbox" v-model="showCompleted" />
                        <span class="lever"></span>
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="col s12 black-pearl-text">
                    <div class="col l6 s12 exchange" v-for="exchange in exchangesShown" :id="`exchange-${exchange.id}`">
                        <div
                            class="card horizontal"
                            v-if="exchange.statusId === 1"
                            :key="exchange.id"
                        >
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${getOtherUser(exchange).user.avatar}`" :alt="getOtherUser(exchange).user.username" :title="getOtherUser(exchange).user.username">
                                <img
                                    v-if="startedByMe(exchange)"
                                    class="responsive-img"
                                    src="http://localhost:8080/img/esperant-llibre.jpg"
                                />
                                <img
                                    v-else
                                    class="responsive-img"
                                    :src="`/img/covers/${exchange.books[0].book.cover}`"
                                />
                            </div>
                            <div class="col valign-wrapper">
                                <i class="material-icons medium atoll-text"
                                    >swap_horiz</i
                                >
                            </div>
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${me(exchange).user.avatar}`" :alt="me(exchange).user.username">
                                <img
                                    v-if="! startedByMe(exchange)"
                                    class="responsive-img"
                                    src="http://localhost:8080/img/esperant-llibre.jpg"
                                />
                                <img
                                    v-else
                                    class="responsive-img"
                                    :src="`/img/covers/${exchange.books[0].book.cover}`"
                                />
                            </div>
                            <div class="timeline col l2">
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons"
                                            >hourglass_empty</i
                                        >
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">thumb_up</i>
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">done</i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content valign-wrapper">
                                <span
                                    v-if="startedByMe(exchange)"
                                    class="card-title activator center-align"
                                    >Intercanvi<br />proposat<br /><br />
                                    <a
                                        class="btn-floating waves-effect waves-light large azure"
                                    >
                                        <i
                                            class="material-icons medium atoll-text"
                                            >more_horiz</i
                                        >
                                    </a>
                                </span>
                                <span
                                    v-else
                                    class="card-title activator center-align"
                                    >Proposta<br />rebuda<br /><br />
                                    <a
                                        class="btn-floating waves-effect waves-light large azure"
                                    >
                                        <i
                                            class="material-icons medium atoll-text"
                                            >more_horiz</i
                                        >
                                    </a>
                                </span>
                            </div>
                            <div class="card-reveal">
                                <span
                                    v-if="startedByMe(exchange)"
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Intercanvi proposat</strong
                                    ><br /><br />
                                    <a
                                        :href="getOtherUserLink(exchange)"
                                        class="user-link"
                                        >{{ getOtherUser(exchange).user.username
                                        }}</a
                                    >
                                    ha rebut la teva petició d'intercanvi. Ara
                                    toca esperar a que triï un llibre teu.<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, false)"
                                        >
                                            Cancel·lar intercanvi
                                        </button>
                                    </div>
                                </span>
                                <span
                                    v-else
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Proposta rebuda</strong><br /><br />
                                    Si estàs interessat, tria un llibre de
                                    <a
                                        :href="getOtherUserLink(exchange)"
                                        class="user-link"
                                        >{{ getOtherUser(exchange).user.username
                                        }}</a
                                    >.<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="showUserBooks(exchange)"
                                        >
                                            Triar Llibre
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, false)"
                                        >
                                            Rebutjar intercanvi
                                        </button>
                                    </div>
                                </span>
                            </div>
                        </div>

                        <div
                            class="card horizontal"
                            v-if="exchange.statusId === 2"
                            :key="exchange.id"
                        >
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${getOtherUser(exchange).user.avatar}`" :alt="getOtherUser(exchange).user.username" :title="getOtherUser(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatTheOtherUserWants(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="col valign-wrapper">
                                <i class="material-icons medium atoll-text"
                                    >swap_horiz</i
                                >
                            </div>
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${me(exchange).user.avatar}`" :alt="me(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatIWant(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="timeline col l2">
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons"
                                            >hourglass_empty</i
                                        >
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">thumb_up</i>
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">done</i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content valign-wrapper">
                                <span class="card-title activator center-align"
                                    >Pendent<br />d'acceptació<br /><br />
                                    <a
                                        class="btn-floating waves-effect waves-light large azure"
                                    >
                                        <i
                                            class="material-icons medium atoll-text"
                                            >more_horiz</i
                                        >
                                    </a>
                                </span>
                            </div>
                            <div class="card-reveal">
                                <span
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Pendent d'acceptació</strong
                                    ><br /><br />
                                    Tots dos heu triat un llibre. Estàs d'acord
                                    amb l'intercanvi?<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, true)"
                                        >
                                            Acceptar
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, false)"
                                        >
                                            Cancel·lar
                                        </button>
                                    </div>
                                </span>
                            </div>
                        </div>

                        <div
                            class="card horizontal"
                            v-if="exchange.statusId === 3"
                            :key="exchange.id"
                        >
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${getOtherUser(exchange).user.avatar}`" :alt="getOtherUser(exchange).user.username" :title="getOtherUser(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatTheOtherUserWants(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="col valign-wrapper">
                                <i class="material-icons medium atoll-text"
                                    >swap_horiz</i
                                >
                            </div>
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${me(exchange).user.avatar}`" :alt="me(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatIWant(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="timeline col l2">
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons"
                                            >hourglass_empty</i
                                        >
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">thumb_up</i>
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">done</i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content valign-wrapper">
                                <span class="card-title activator center-align"
                                    >Pendent<br />d'acceptació<br /><br />
                                    <a
                                        class="btn-floating waves-effect waves-light large azure"
                                    >
                                        <i
                                            class="material-icons medium atoll-text"
                                            >more_horiz</i
                                        >
                                    </a>
                                </span>
                            </div>
                            <div class="card-reveal">
                                <span
                                    v-if="getApprovalStatus(exchange).iHaveDecided"
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Pendent d'acceptació</strong
                                    ><br /><br />
                                    Estem esperant que
                                    <a
                                        class="user-link"
                                        :href="getOtherUserLink(exchange)"
                                        >{{ getOtherUser(exchange).user.username
                                        }}</a
                                    >
                                    accepti l'intercanvi. Ja queda poc!<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, false)"
                                        >
                                            Cancel·lar intercanvi
                                        </button>
                                    </div>
                                </span>
                                <span
                                    v-else
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Pendent d'acceptació</strong
                                    ><br /><br />
                                    <a
                                        class="user-link"
                                        :href="getOtherUserLink(exchange)"
                                        >{{ getOtherUser(exchange).user.username
                                        }}</a
                                    >
                                    ha acceptat l'intercanvi. Hi estàs d'acord
                                    tu també?<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, true)"
                                        >
                                            Acceptar
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postApproval(exchange.id, false)"
                                        >
                                            Cancel·lar
                                        </button>
                                    </div>
                                </span>
                            </div>
                        </div>

                        <div
                            class="card horizontal"
                            v-if="exchange.statusId === 4"
                            :key="exchange.id"
                        >
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${getOtherUser(exchange).user.avatar}`" :alt="getOtherUser(exchange).user.username" :title="getOtherUser(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatTheOtherUserWants(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="col valign-wrapper">
                                <i class="material-icons medium atoll-text"
                                    >swap_horiz</i
                                >
                            </div>
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${me(exchange).user.avatar}`" :alt="me(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatIWant(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="timeline col l2">
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons"
                                            >hourglass_empty</i
                                        >
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons">thumb_up</i>
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge oyster-bay azure-text"
                                    >
                                        <i class="material-icons">done</i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content valign-wrapper">
                                <span class="card-title activator center-align"
                                    >Intercanvi<br />acceptat!<br /><br />
                                    <a
                                        class="btn-floating waves-effect waves-light large azure"
                                    >
                                        <i
                                            class="material-icons medium atoll-text"
                                            >more_horiz</i
                                        >
                                    </a>
                                </span>
                            </div>
                            <div class="card-reveal">
                                <span
                                    v-if="noOneHasClosed(exchange)"
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Intercanvi acceptat!</strong
                                    ><br /><br />
                                    Els dos usuaris esteu d'acord en realitzar
                                    l'intercanvi. Què espereu per a quedar?<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="openChat(exchange.id)"
                                        >
                                            Obrir conversa
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postConclusion(exchange.id, true)"
                                        >
                                            Completar
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postConclusion(exchange.id, false)"
                                        >
                                            Cancel·lar
                                        </button>
                                    </div>
                                </span>
                                <span
                                    v-else-if="iHaveClosed(exchange)"
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Pendent de compleció</strong
                                    ><br /><br />
                                    Quan
                                    <a
                                        class="user-link"
                                        :href="getOtherUserLink(exchange)"
                                        >{{ getOtherUser(exchange).user.username
                                        }}</a
                                    >
                                    completi l'intercanvi, les vostres
                                    col·leccions de llibres s'actualitzaran
                                    automàticament.<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="openChat"
                                        >
                                            Obrir conversa
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postConclusion(exchange.id, false)"
                                        >
                                            Cancel·lar intercanvi
                                        </button>
                                    </div>
                                </span>
                                <span
                                    v-else
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong
                                        >Ja heu intercanviat els
                                        llibres?</strong
                                    ><br /><br />
                                    Completa l'intercanvi perquè les vostres
                                    col·leccions de llibres s'actualitzin
                                    automàticament.<br /><br />
                                    <div class="center-align">
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="openChat"
                                        >
                                            Obrir conversa
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postConclusion(exchange.id, true)"
                                        >
                                            Completar
                                        </button>
                                        <button
                                            class="btn-large waves-effect waves-light light-sea-green azure-text"
                                            @click="postConclusion(exchange.id, false)"
                                        >
                                            Cancel·lar
                                        </button>
                                    </div>
                                </span>
                            </div>
                        </div>

                        <div
                            class="card horizontal"
                            v-if="exchange.statusId === 6"
                            :key="exchange.id"
                        >
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${getOtherUser(exchange).user.avatar}`" :alt="getOtherUser(exchange).user.username" :title="getOtherUser(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatTheOtherUserWants(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="col valign-wrapper">
                                <i class="material-icons medium atoll-text"
                                    >swap_horiz</i
                                >
                            </div>
                            <div class="col l5 valign-wrapper">
                                <img class="avatar" :src="`/img/avatars/${me(exchange).user.avatar}`" :alt="me(exchange).user.username">
                                <img
                                    class="responsive-img"
                                    :src="`/img/covers/${booksThatIWant(exchange.books)[0].book.cover}`"
                                />
                            </div>
                            <div class="timeline col l2">
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons"
                                            >hourglass_empty</i
                                        >
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons">thumb_up</i>
                                    </div>
                                </div>
                                <div class="timeline-event">
                                    <div style="height: 100px;"></div>
                                    <div
                                        class="timeline-badge atoll azure-text"
                                    >
                                        <i class="material-icons">done</i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content valign-wrapper">
                                <span class="card-title activator center-align"
                                    >Intercanvi<br />completat!<br /><br />
                                    <a
                                        class="btn-floating waves-effect waves-light large azure"
                                    >
                                        <i
                                            class="material-icons medium atoll-text"
                                            >more_horiz</i
                                        >
                                    </a>
                                </span>
                            </div>
                            <div class="card-reveal">
                                <span
                                    class="card-title black-pearl-text text-darken-4"
                                >
                                    <i class="material-icons right">close</i>
                                    <strong>Intercanvi completat!</strong
                                    ><br /><br />
                                    Esperem que gaudeixques del teu nou llibre
                                    :-)
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal">
                    <div class="modal-content">
                        <h4 class="black-pearl-text center-align">
                            Segur que vols cancel·lar l'intercanvi?
                        </h4>
                        <p class="black-pearl-text center-align">
                            Si us plau, confirma que vols cancel·lar l'intercanvi.
                        </p>
                    </div>

                    <div class="modal-footer">
                        <a
                            @click="modal.close()"
                            class="modal-close waves-effect waves-green btn-flat atoll-text bolder"
                            >Tornar enrere</a
                        >
                        <a
                            class="modal-close waves-effect waves-green btn-flat atoll-text bolder"
                            @click="approve(selectedExchangeId, false)"
                            >Cancel·lar intercanvi</a
                        >
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <p layout:fragment="footer"></p>
        </footer>

        <th:block layout:fragment="script">
            <script th:inline="javascript">
                /*<![CDATA[*/ window.myUserId = /*[[${myUserId}]]*/ null;
                /*]]>*/
            </script>
            <script th:src="@{/js/els-meus-intercanvis.js}"></script>
        </th:block>
    </body>
</html>
